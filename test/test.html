<!DOCTYPE html>
<html>

<head>
<title>jQuery-CSV Testing</title>
<meta charset="UTF-8" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="../src/jquery.csv.js"></script>
<script src="qunit.js"></script>
<link media="screen" href="qunit.css" rel="stylesheet"/>
<script>
$(document).ready(function() {

  // initialize the data for the 'core' module
  function coreDataInit() {
    toArray = '"You will come back stronger then ever","like Lance Armstrong","but with two balls"';
    fromArray = ["You will come back stronger then ever","like Lance Armstrong","but with two balls"];

    toArrays = '';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."\n';
    toArrays += '"All work","and no play","makes Jack","a dull boy..."';

    fromArrays = [];
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);
    fromArrays.push(["All work","and no play","makes Jack","a dull boy..."]);

    toObjects = '"ID","iManufacturer","iMPartNumber","iSerialNumber","iSimCategory","iPartType","iDescription","iGroup","iLocation","iSold"\n';
    toObjects += '"1","Evans & Sutherland","230-132-111AA","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"2","Evans & Sutherland","230-132-111AA","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"3","Evans & Sutherland","230-120-112AC","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"4","Evans & Sutherland","230-120-112AC","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"5","Evans & Sutherland","230-120-112AC","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"6","Evans & Sutherland","230-120-112AC","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"7","Evans & Sutherland","230-120-112AC","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"8","Evans & Sutherland","230-120-112AC","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"9","Evans & Sutherland","230-120-112AC","","Visual","PCB","","1","Offsite",""\n';
    toObjects += '"10","Evans & Sutherland","230-121-150AC","","Visual","PCB","","1","Offsite",""';

    fromObjects = [];
    fromObjects.push({ID:"1",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-132-111AA",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"2",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-132-111AA",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"3",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-120-112AC",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"4",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-120-112AC",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"5",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-120-112AC",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"6",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-120-112AC",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"7",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-120-112AC",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"8",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-120-112AC",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"9",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-120-112AC",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});
    fromObjects.push({ID:"10",iManufacturer:"Evans & Sutherland",iMPartNumber:"230-121-150AC",iSerialNumber:"",iSimCategory:"Visual",iPartType:"PCB",iDescription:"",iGroup:"1",iLocation:"Offsite",iSold:""});

    testEscaping = [];
    testEscaping.push('"1","he said ""you are crazy""","one "", two "", three """');
    testEscaping.push("'2','he said ''you are crazy''','one '', two '', three '''");
    testEscaping.push('"3";"he said ""you are crazy""";"one "", two "", three """');
    testEscaping.push('"4"|"he said ""you are crazy"""|"one "", two "", three """');
    resultEscaping = [];
    resultEscaping.push(['1', 'he said "you are crazy"', 'one ", two ", three "']);
    resultEscaping.push(['2', 'he said \'you are crazy\'', 'one \', two \', three \'']);
    resultEscaping.push(['3', 'he said "you are crazy"', 'one ", two ", three "']);
    resultEscaping.push(['4', 'he said "you are crazy"', 'one ", two ", three "']);

    testRFCCompliance1 = '';
    testRFCCompliance1 += 'aaa,bbb,ccc\r\n';
    testRFCCompliance1 += 'zzz,yyy,xxx\r\n';
    resultRFCCompliance1 = [];
    resultRFCCompliance1.push(['aaa','bbb','ccc']);
    resultRFCCompliance1.push(['zzz','yyy','xxx']);
    testRFCCompliance2 = '';
    testRFCCompliance2 += 'aaa,bbb,ccc\r\n';
    testRFCCompliance2 += 'zzz,yyy,xxx';
    resultRFCCompliance2 = [];
    resultRFCCompliance2.push(['aaa','bbb','ccc']);
    resultRFCCompliance2.push(['zzz','yyy','xxx']);
    testRFCCompliance3 =  '';
    testRFCCompliance3 += 'field_name,field_name,field_name\r\n';
    testRFCCompliance3 += 'aaa,bbb,ccc\r\n';
    testRFCCompliance3 += 'zzz,yyy,xxx\r\n';
    resultRFCCompliance3 = [];
    resultRFCCompliance3.push({field_name:'aaa',field_name:'bbb',field_name:'ccc'});
    resultRFCCompliance3.push({field_name:'zzz',field_name:'yyy',field_name:'xxx'});
    testRFCCompliance4 = '';
    testRFCCompliance4 += 'aaa , bbb, c  cc\r\n';
    resultRFCCompliance4 = [];
    resultRFCCompliance4.push(['aaa ',' bbb',' c  cc']);
    testRFCCompliance5 = '';
    testRFCCompliance5 += '"aaa","bbb","ccc"\r\n';
    testRFCCompliance5 += 'zzz,yyy,xxx';
    resultRFCCompliance5 = [];
    resultRFCCompliance5.push(['aaa','bbb','ccc']);
    resultRFCCompliance5.push(['zzz','yyy','xxx']);
    testRFCCompliance6 = '';
    testRFCCompliance6 += '"aaa","b\r\nbb","cc,c"\r\n';
    testRFCCompliance6 += 'zzz,yyy,xxx';
    resultRFCCompliance6 = [];
    resultRFCCompliance6.push(['aaa','b\r\nbb','cc,c']);
    resultRFCCompliance6.push(['zzz','yyy','xxx']);
    testRFCCompliance7 = '';
    testRFCCompliance7 += '"aaa","b""bb","ccc"';
    resultRFCCompliance7 = [];
    resultRFCCompliance7.push(['aaa','b"bb','ccc']);
    testRFCComplianceA1 = '';
    testRFCComplianceA1 += 'aaa,,ccc';
    resultRFCComplianceA1 = [];
    resultRFCComplianceA1.push(['aaa','','ccc']);
    testRFCComplianceA2 = '';
    testRFCComplianceA2 += '"aaa","","ccc"';
    resultRFCComplianceA2 = [];
    resultRFCComplianceA2.push(['aaa','','ccc']);
    testRFCComplianceA3 = '';
    testRFCComplianceA3 += '"aaa","bbb",';
    resultRFCComplianceA3 = [];
    resultRFCComplianceA3.push(['aaa','bbb','']);

    testHook1 = '';
    testHook1 += '734,4.5,sda,"555","4523.35","af323"';
    resultHook1 = [];
    resultHook1.push([734,4.5,"sda",555,4523.35,"af323"]);
    testHook2 = '';
    testHook2 += '"You have the right","to remain silent","but","I\'m gonna make","ya scream!"';
    resultHook2 = [];
    resultHook2.push(["I\'m gonna make","ya scream!"]);
    testHook3 = '';
    testHook3 += 'fluffy\n';
    testHook3 += 'nutter\n';
    testHook3 += 'funny\n';
    testHook3 += 'fuffer\n';
    resultHook3 = [];
    resultHook3.push(['funny']);
    resultHook3.push(['fuffer']);

    testNodeCallbacks = '';
    testNodeCallbacks += '"What are you","knittin\' a f*&%ing sweater"\n';
    testNodeCallbacks += '"I\'m trying to put some","tigers balm","on this jungle\'s nuts"';
    resultNodeCallbacks = [];
    resultNodeCallbacks.push(["What are you","knittin' a f*&%ing sweater"]);
    resultNodeCallbacks.push(["I'm trying to put some","tigers balm","on this jungle's nuts"]);
  }

  module("core", { setup:function(){ coreDataInit() }});
  test("Parsing - to Array", function() {
    expect(1);
    stop();
    var output = $.csv.toArray(toArray);
    start();
    deepEqual(output, fromArray, "$csv.toArray()");
  });

  test("Parsing - to Arrays", function() {
    expect(1);
    stop();
    var output = $.csv.toArrays(toArrays);
    start();
    deepEqual(output, fromArrays, "$.csv.toArrays()");
    // TODO: Add tests
    //stop();
    //var output = $.fromArray(fromArray);
    //start();
    //deepEqual(output, toArray, "$.csv.fromArray()");
    //stop();
    //var output = $.fromArrays(fromArrays);
    //start();
    //deepEqual(output, toArrays, "$.csv.fromArrays()");
  });

  test("Parsing - to Objects", function() {
    expect(1);
    stop();
    var output = $.csv.toObjects(toObjects);
    start();
    deepEqual(output, fromObjects, "$.csv.toObjects()");
    // TODO: Add test
    //stop();
    //var output = $.fromObjects(fromObjects);
    //start();
    //deepEqual(output, fromObjects, "$.csv.fromObjects()");
  });

  test("RFC 4801 Compliance", function() {
    expect(10);
    stop();
    var output = $.csv.toArrays(testRFCCompliance1);
    start();
    deepEqual(output, resultRFCCompliance1, "Rule #1 - One entry per line, each line ends with a newline");
    stop();
    var output = $.csv.toArrays(testRFCCompliance2);
    start();
    deepEqual(output, resultRFCCompliance2, "Rule #2 - Trailing newline at the end of the file omitted");
    stop();
    var output = $.csv.toObjects(testRFCCompliance3);
    start();
    deepEqual(output, resultRFCCompliance3, "Rule #3 - First row contains header data");
    stop();
    var output = $.csv.toArrays(testRFCCompliance4);
    start();
    deepEqual(output, resultRFCCompliance4, "Rule #4 - Spaces are considered data and entries should not contain a trailing comma");
    stop();
    var output = $.csv.toArrays(testRFCCompliance5);
    start();
    deepEqual(output, resultRFCCompliance5, "Rule #5 - Lines may or may not be delimited by double-quotes");
    stop();
    var output = $.csv.toArrays(testRFCCompliance6);
    start();
    deepEqual(output, resultRFCCompliance6, "Rule #6 - Fields containing line breaks, double-quotes, and commas should be enclosed in double-quotes");
    stop();
    var output = $.csv.toArrays(testRFCCompliance7);
    start();
    deepEqual(output, resultRFCCompliance7, "Rule #7 - If double-quotes are used to enclose fields, then a double-quote appearing inside a field must be escaped by preceding it with another double quote");
    stop();
    var output = $.csv.toArrays(testRFCComplianceA1);
    start();
    deepEqual(output, resultRFCComplianceA1, "Amendment #1 - An unquoted field may or may not contain a null value");
    stop();
    var output = $.csv.toArrays(testRFCComplianceA2);
    start();
    deepEqual(output, resultRFCComplianceA2, "Amendment #2 - A quoted field may or may not contain a null value");
    stop();
    var output = $.csv.toArrays(testRFCComplianceA3);
    start();
    deepEqual(output, resultRFCComplianceA3, "Amendment #3 - The last field in an entry may or may not contain a null value");
  });

  test("Custom Control Chars - Delimiter, Separator", function() {
    expect(4);
    stop();
    var output = $.csv.toArray(testEscaping[0]);
    start();
    deepEqual(output, resultEscaping[0], "standard delimiter/separator/escaper");
    stop();
    var output = $.csv.toArray(testEscaping[1], {
      delimiter:"'"
    });
    start();
    deepEqual(output, resultEscaping[1], "custom delimiter");
    stop();
    var output = $.csv.toArray(testEscaping[2], {
      separator:';'
    });
    start();
    deepEqual(output, resultEscaping[2], "custom separator");
    stop();
    var output = $.csv.toArray(testEscaping[3], {
      separator:'|'
    });
    start();
    deepEqual(output, resultEscaping[3], "regex escaped inputs");
  });

  test("Hooks & User-Defined Callbacks", function() {
    expect(3);
    stop();
    var output = $.csv.toArrays(testHook1, {
      onParseValue: $.csv.hooks.castToScalar
    });
    start();
    deepEqual(output, resultHook1, "onParseValue - casting values to scalar types");
    stop();
    var columnRange = function(value, state) {
      var start = 4;
      var end = 5;
      if(state.colNum >= start && state.colNum <= end) {
        return value;
      }
      return false;
    }    
    var output = $.csv.toArrays(testHook2, {
      onParseValue: columnRange
    });
    start();
    deepEqual(output, resultHook2, "onParseValue - selecting a column range");
    stop();
    var rowRange = function(entry, state) {
      var start = 3;
      var end = 4;
      if(state.rowNum >= start && state.rowNum <= end) {
        return entry;
      }
      return false;
    }  
    var output = $.csv.toArrays(testHook3, {
      onParseEntry: rowRange
    });
    start();
    deepEqual(output, resultHook3, "onParseEntry - selecting a row range");
  });

  test("Node.js", function() {
    expect(1);
    stop();
    $.csv.toArrays(testNodeCallbacks, {}, function(err, output) {
      deepEqual(output, resultNodeCallbacks, "Node.js-style callback support");
    });
    start();
  });
});
</script>
</head>

<body>
  <h1 id="qunit-header">jQuery-CSV Testing</h1>
  <h2 id="qunit-banner"></h2>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests">
  </ol>
</body>

</html>